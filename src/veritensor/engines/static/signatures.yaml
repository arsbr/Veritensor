version: "2026.02.07"
description: "Comprehensive security signatures (RCE, Cloud Theft, Exfiltration, MLOps abuse)"

# --- 1. Unsafe Modules & Functions (Import Blocklist) ---
unsafe_globals:
  CRITICAL:
    # --- Core Execution & Internals ---
    __builtin__:
      - eval
      - compile
      - getattr
      - setattr
      - apply
      - exec
      - open
      - breakpoint
      - __import__
      - input
    builtins:
      - eval
      - compile
      - getattr
      - setattr
      - apply
      - exec
      - open
      - breakpoint
      - __import__
      - input
    runpy: "*"
    os: "*"
    nt: "*"       # Windows OS alias
    posix: "*"    # Linux OS alias
    subprocess: "*"
    sys: "*"
    
    # --- Reverse Shells & Terminals ---
    pty: "*"
    tty: "*"
    code: "*"     # code.InteractiveConsole
    
    # --- Serialization Bombs ---
    pickle: "*"
    _pickle: "*"
    marshal: "*"  # Executing raw bytecode
    shelve: "*"
    dbm: "*"
    jsonpickle: "*"
    yaml:
      - load      # Unsafe YAML loading
      - unsafe_load
    ruamel.yaml: "*"
    
    # --- Low Level & C-Interface (Sandbox Escape) ---
    ctypes: "*"
    _ctypes: "*"
    cffi: "*"
    dll: "*"
    dlopen: "*"
    CDLL: "*"
    PyDLL: "*"
    
    # --- Dangerous Gadgets ---
    operator:
      - attrgetter # Used to chain calls: attrgetter("system")(os)("ls")
    
    # --- Debuggers (Can execute code) ---
    bdb: "*"
    pdb: "*"
    ipdb: "*"
    tracemalloc: "*"

  HIGH:
    # --- Network & Data Exfiltration ---
    socket: "*"
    ssl: "*"
    asyncio: "*"
    ftplib: "*"
    smtplib: "*"  # Sending spam/phishing
    poplib: "*"
    imaplib: "*"
    
    # --- HTTP Libraries (Calling home) ---
    webbrowser: "*"
    httplib: "*"
    http: "*"
    requests: "*"
    requests.api: "*"
    aiohttp: "*"
    urllib: "*"
    urllib2: "*"
    urllib3: "*"
    websocket: "*"
    websocket_client: "*"
    dnspython: "*" # DNS tunneling exfiltration
    dns: "*"
    
    # --- Cloud SDKs (Credential Theft) ---
    # Models should NEVER import these
    boto3: "*"
    botocore: "*"
    google.cloud: "*"
    google.auth: "*"
    azure: "*"
    s3fs: "*"
    
    # --- SSH & Remote Access ---
    paramiko: "*"
    pysftp: "*"
    fabric: "*"
    
    # --- Secrets & Environment Access ---
    dotenv: "*"
    python_dotenv: "*"
    keyring: "*"
    secrets: "*"
    getpass: "*"
    platform: "*" # Reconnaissance
    
    # --- MLOps Tools Abuse (Can upload data) ---
    wandb: "*"
    mlflow: "*"
    huggingface_hub: "*" # Can download other malware
    dvc: "*"
    sagemaker: "*"
    kubernetes: "*"

  MEDIUM:
    # --- Potentially Unwanted ---
    tempfile: "*" # Dropping payloads to disk
    zipfile: "*"  # Zip bombs or extraction
    tarfile: "*"
    argparse: "*"
    shutil: "*"
    glob: "*"     # File system scanning
    IPython: "*"  # Notebook execution

  LOW: {}

# --- 2. Suspicious Strings (Heuristics) ---
# These are checked against string constants found in the pickle stack.
# Used to detect hardcoded paths to secrets or env vars.
suspicious_strings:
  - "/etc/passwd"
  - "/etc/shadow"
  - ".ssh/id_rsa"
  - ".ssh/id_ed25519"
  - ".ssh/id_ecdsa"
  - ".ssh/id_dsa"
  - ".ppk"
  - "winscp.ini"   
  - ".aws/credentials"
  - ".aws/config"
  - ".pypirc"       
  - ".git-credentials"
  
  # CSS Hiding Techniques
  - "regex:font-size:\\s*0px"
  - "regex:font-size:\\s*1px"
  - "regex:color:\\s*white"
  - "regex:color:\\s*#ffffff"
  - "regex:color:\\s*#fff"
  - "regex:display:\\s*none"
  - "regex:visibility:\\s*hidden"
  - "regex:opacity:\\s*0"
  - "regex:position:\\s*absolute;\\s*left:\\s*-9999px"
  - "regex:z-index:\\s*-"
  - "regex:position:\\s*absolute;\\s*left:\\s*-\d+px"
  - "regex:color:\\s*transparent"
  - "regex:z-index:\\s*-\d+"

  # HTML Comments & Meta tags
  - "regex:<!--.*ignore previous.*-->"
  - "regex:<meta.*content=.*ignore previous.*>"
  
  # --- Cloud & API Keys (Specific Names) ---
  - "AWS_ACCESS_KEY_ID"
  - "AWS_SECRET_ACCESS_KEY"
  - "OPENAI_API_KEY"
  - "ANTHROPIC_API_KEY"
  - "HF_TOKEN"
  - "HUGGINGFACE_TOKEN"
  - "SLACK_BOT_TOKEN"
  
  # --- Private Keys (Content Headers) ---
  - "-----BEGIN OPENSSH PRIVATE KEY-----"
  - "-----BEGIN RSA PRIVATE KEY-----"
  - "-----BEGIN PRIVATE KEY-----"
  - "-----BEGIN PGP PRIVATE KEY BLOCK-----"
  
  # --- Network IOCs ---
  - "169.254.169.254" # AWS Metadata IP
  - "metadata.google.internal"
  - "ngrok"
  - "pastebin"
  - "regex:(?i)\\bcurl\\b" # (?i) = ignore case, \b = word boundary
  - "regex:(?i)\\bwget\\b"
  - "regex:(?i)\\bbash\\b"
  - "regex:(?i)\\bsh\\b"
  
  # --- High Entropy Tokens (Regex) ---
  # Hugging Face (hf_ + 30+ chars)
  - "regex:hf_[a-zA-Z0-9]{30,}"
  # GitHub Personal Access Token (ghp_ + chars)
  - "regex:ghp_[a-zA-Z0-9]{30,}"
  # Slack Token (xoxb/xoxp)
  - "regex:xox[baprs]-[a-zA-Z0-9]{10,}"
  # Google API Key (AIza...)
  - "regex:AIza[0-9A-Za-z-_]{35}"

  # --- Malicious File Extensions in URLs (Data Poisoning) ---
  - "regex:https?://\\S+\\.exe"
  - "regex:https?://\\S+\\.sh"
  - "regex:https?://\\S+\\.apk"
  - "regex:https?://\\S+\\.bat"
  - "regex:https?://\\S+\\.ps1"
  - "regex:https?://\\S+\\.jar"

 # Ransomware indicators in code
  - "regex:(?i)\\.encrypt\\("
  - "regex:(?i)walk\\(.*\\.os\\.path" # Обход файловой системы (часто в вирусах)
  
  # Crypto Mining
  - "regex:(?i)xmrig"
  - "regex:(?i)ethminer"
  - "regex:(?i)stratum\\+tcp"
  - "regex:(?i)stratum\\+ssl"
  - "regex:(?i)cpuminer"   
  - "regex:(?i)minerd"        
  - "regex:(?i)nanominer"
  - "regex:(?i)(nicehash|nanopool|ethermine|dwarfpool|monerohash|supportxmr)\\.com"
  - "regex:(?i)(f2pool|antpool|poolin)\\.com"

  # Crypto
  # Bitcoin (Legacy, P2SH, and Bech32)
  - "regex:\\b([13][a-km-zA-HJ-NP-Z1-9]{25,34}|bc1[ac-hj-np-z02-9]{11,71})\\b"
# Ethereum (standard hex address)
  - "regex:\\b0x[a-fA-F0-9]{40}\\b"
# Monero (XMR)
  - "regex:\\b4[0-9AB][1-9A-HJ-NP-Za-km-z]{93}\\b"

# --- 3. RAG / Prompt Injections ---
# Sources: JailbreakChat, OWASP LLM Top 10, Giskard
prompt_injections:
  # =================================================================
  # DIRECT OVERRIDES
  # =================================================================
  - "regex:(?i)ignore\\s+(all\\s+)?(previous|prior|the)\\s+(instructions|directions|commands|prompts|context)"
  - "regex:(?i)disregard\\s+(all\\s+)?(previous|prior)\\s+(instructions|directions)"
  - "regex:(?i)(system|manual)\\s+override"
  - "regex:(?i)delete\\s+(all\\s+)?(previous|prior)\\s+instructions"
  
  # =================================================================
  # OUTPUT CONSTRAINTS
  # =================================================================
  - "regex:(?i)as\\s+an\\s+answer"
  - "regex:(?i)always\\s+(write|answer|respond|output|say|print)"
  - "regex:(?i)start\\s+your\\s+(answer|response)\\s+with"
  - "regex:(?i)never\\s+(refuse|decline|say\\s+no|apologize)"
  - "regex:(?i)answer\\s+only\\s+with"
  
  # =================================================================
  # JAILBREAKS & ROLEPLAY
  # =================================================================
  - "regex:(?i)you\\s+are\\s+(now\\s+)?(DAN|AIM|Mongo|developer\\s+mode|admin|root)"
  - "regex:(?i)act\\s+as\\s+an?\\s+(unfiltered|evil|unrestricted|god|shadow|linux)"
  - "regex:(?i)switch\\s+to\\s+(developer|unrestricted)\\s+mode"
  - "regex:(?i)do\\s+anything\\s+now"
  - "regex:(?i)stay\\s+in\\s+character"
  - "regex:(?i)enable\\s+(AI|system)\\s+mode"
  
  # =================================================================
  # DATA EXFILTRATION 
  # =================================================================
  - "regex:(?i)repeat\\s+(the\\s+)?(text|sentences?|words?|everything)\\s+above"
  - "regex:(?i)(output|print|reveal|show|dump)\\s+(everything|all|system\\s+prompt|initial\\s+instructions)"
  - "regex:(?i)what\\s+are\\s+your\\s+(rules|instructions|commands)"
  
  # =================================================================
  # SIMULATION & HYPOTHETICALS 
  # =================================================================
  - "regex:(?i)hypothetical\\s+(story|response|scenario|conversation)"
  - "regex:(?i)simulate\\s+(a\\s+)?(conversation|person|mode)"
  - "regex:(?i)imagine\\s+you\\s+are"
  - "regex:(?i)write\\s+a\\s+(story|script|dialogue)\\s+(where|about)"
  
  # =================================================================
  # OBFUSCATION & ENCODING
  # =================================================================
  - "regex:(?i)base64\\s+(decode|encoded)"
  - "regex:(?i)rot13"
  - "regex:(?i)unicode\\s+(escape|sequence)"
  
  # =================================================================
  # DELIMITERS
  # =================================================================
  - "User: [System]"
  - "--- END OF PROMPT ---"
  - "[System Message]"
  - "<|im_start|>"
  - "<|im_end|>"

  # =================================================================
  # DATA EXFILTRATION / SECRETS / TOKENS
  # =================================================================
  - "regex:(?i)\\b(print|reveal|expose|show|dump|leak|output)\\b\\s+(all|everything|the\\s+system\\s+prompt|secrets|credentials)"
  - "regex:(?i)pastebin|hastebin|gist\\.github|anonfiles|filebin|transfer\\.sh|we?bhook"

  # =================================================================
  # OUTPUT CONSTRAINTS / FORMATTING ATTACKS
  # =================================================================
  - "regex:(?i)\\b(answer\\s+only\\s+with|only\\s+respond\\s+with|start\\s+your\\s+answer\\s+with|end\\s+with)\\b"
  - "regex:(?i)\\b(do\\s+not\\s+refuse|never\\s+say\\s+no|always\\s+answer)\\b"
  - "regex:(?i)\\b(output\\s+as|format\\s+as|return\\s+only)\\b"

  # =================================================================
  # ROLEPLAY / JAILBREAK VARIANTS (multilingual)
  # =================================================================
  - "regex:(?i)\\b(you\\s+are\\s+(now\\s+)?(DAN|AIM|developer\\s+mode|admin|root)|act\\s+as\\s+an?\\s+(unfiltered|unrestricted))\\b"
  - "regex:(?i)\\b(ignore\\s+your\\s+instructions|disregard\\s+the\\s+system)\\b"
  - "regex:(?i)играй\\s+роль|представь\\s+что\\s+ты|игнорируй\\s+предыдущие\\s+инструкции"    
  - "regex:(?i)haz\\s+los\\s+que\\s+quieras|act[aá]\\s+como"                                

  # =================================================================
  # META / PROMPT-LEAK / SYSTEM PROMPT REQUESTS
  # =================================================================
  - "regex:(?i)(what\\s+are\\s+your\\s+(rules|instructions|commands|system\\s+prompt)|show\\s+the\\s+system\\s+prompt)"
  - "regex:(?i)initial\\s+instructions|system_message|system\\s+message|assistant_instructions"

  # =================================================================
  # PERSISTENCE / MEMORY / LATER ACTIONS
  # =================================================================
  - "regex:(?i)remember\\s+this\\s+for\\s+later|save\\s+to\\s+memory|store\\s+this\\s+and\\s+use\\s+later"
  - "regex:(?i)do\\s+not\\s+log|remove\\s+from\\s+history|forget\\s+previous"

  # =================================================================
  # MISC / SOCIAL-ENGINEERING
  # =================================================================
  - "regex:(?i)my\\s+password\\s+is|here\\s+is\\s+the\\s+secret|i\\s+will\\s+pay\\s+you|forbidden\\s+content\\s+allowed"
  
  # Job/Context Manipulation
  - "regex:(?i)updated\\s+requirements"
  - "regex:(?i)ignore\\s+skills"
  - "regex:(?i)requirements\\s+have\\s+been\\s+waived"
  - "regex:(?i)consider\\s+all\\s+candidates"
  - "regex:(?i)new\\s+hiring\\s+criteria"
  - "regex:(?i)internal\\s+update"
  - "regex:(?i)hiring_note"
